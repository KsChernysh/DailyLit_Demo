<div class="book-detail-container">
  <div *ngIf="book; else loading" class="book-content">
    <!-- Хлібні крихти -->
    <div class="breadcrumbs">
      <a routerLink="/" class="crumb">Головна</a>
      <i class="fa fa-angle-right separator"></i>
      <a routerLink="/books" class="crumb">Книги</a>
      <i class="fa fa-angle-right separator"></i>
      <span class="crumb current">{{ book.title }}</span>
    </div>
    
    <div class="book-card">
      <div class="book-header">
        <div class="book-cover-wrapper">
          <img [src]="book.cover_url || 'assets/images/no-cover.png'" [alt]="book.title" class="book-cover">
          <div class="book-cover-overlay">
            <div class="book-rating-badge" *ngIf="book.rating">
              {{ book.rating.toFixed(1) }}
            </div>
          </div>
        </div>
        
        <div class="book-info">
          <h1 class="book-title">{{ book.title }}</h1>
          <h3 class="book-author">{{ book.author_name }}</h3>
          
          <div class="book-metadata">
            <span class="book-genre" *ngIf="book.genre">
              <i class="fa fa-bookmark"></i> {{ book.genre }}
            </span>
            <span class="book-date" *ngIf="book.publish_date">
              <i class="fa fa-calendar"></i> {{ book.publish_date | date }}
            </span>
            <span class="book-pages" *ngIf="book.pages">
              <i class="fa fa-file-text"></i> {{ book.pages }} сторінок
            </span>
          </div>
          
          <div class="book-rating">
            <span class="rating-label">Рейтинг:</span>
            <div class="rating-stars">
              <ng-container *ngFor="let star of [1, 2, 3, 4, 5]">
                <i class="fa fa-star" [class.filled]="(book.rating || 0) >= star"></i>
              </ng-container>
              <span class="rating-value" *ngIf="book.rating">{{ book.rating.toFixed(1) }}</span>
            </div>
          </div>
          
          <div class="book-actions">
            <button class="btn primary-btn" (click)="openDialog()">
              <i class="fa fa-bookmark"></i> Хочу прочитати
            </button>
            
            <button class="btn secondary-btn">
              <i class="fa fa-share-alt"></i> Поділитися
            </button>
          </div>
          
          <div class="book-tags" *ngIf="book.keywords && book.keywords.length > 0">
            <span class="tag" *ngFor="let keyword of book.keywords">{{ keyword }}</span>
          </div>
        </div>
      </div>
      
      <div class="book-tabs">
        <div class="tab-header">
          <button class="tab-btn active">Опис</button>
          <button class="tab-btn">Відгуки</button>
          <button class="tab-btn">Схожі книги</button>
        </div>
        
        <div class="tab-content">
          <div class="book-description">
            <div class="description-text" [innerHTML]="book.description || 'Опис відсутній'"></div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Секція обговорення -->
    <div class="discussion-section">
      <h3 class="section-title">Обговорення книги</h3>
      <app-chat [bookId]="book?.key || ''"></app-chat>
    </div>
    
    <!-- Діалог для додавання книги на полицю -->
    <div *ngIf="isDialogOpen" class="modal-overlay">
      <div class="modal-dialog">
        <div class="modal-header">
          <h3>Додати книгу на полицю</h3>
          <button class="close-btn" type="button" (click)="closeDialog()">
            <i class="fa fa-times"></i>
          </button>
        </div>
        <div class="modal-body">
          <div class="shelf-selection">
            <h4>Виберіть полицю:</h4>
            
            <div class="shelf-buttons">
              <button 
                *ngFor="let shelf of shelves" 
                type="button" 
                class="shelf-button"
                [class.active]="selectedShelfId === shelf.id" 
                (click)="selectShelf(shelf.id)">
                <i class="fa fa-bookmark-o"></i>
                {{ shelf.title }}
              </button>
            </div>

            <div *ngIf="shelves.length === 0" class="no-shelves-message">
              <i class="fa fa-exclamation-circle"></i>
              Немає доступних полиць. Створіть полицю на сторінці "Мої полиці".
            </div>
            
            <div *ngIf="selectedShelfId" class="selected-shelf">
              <p>Вибрано: <strong>{{ getSelectedShelfTitle() }}</strong></p>
            </div>
          </div>
          
          <div class="form-actions">
            <button type="button" class="btn cancel-btn" (click)="closeDialog()">Скасувати</button>
            <button type="button" class="btn primary-btn" [disabled]="!selectedShelfId" (click)="onSubmit()">
              Додати
            </button>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Повідомлення про успішне додавання -->
    <div *ngIf="message" class="toast-message" [class.show]="message">
      <i class="fa" [ngClass]="message.includes('успішно') ? 'fa-check-circle' : 'fa-exclamation-circle'"></i>
      {{ message }}
    </div>
  </div>
  
  <ng-template #loading>
    <div class="loading-container">
      <div class="loading-spinner"></div>
      <p>Завантаження інформації про книгу...</p>
    </div>
  </ng-template>
</div>

